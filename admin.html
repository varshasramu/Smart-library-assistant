<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Library Assistant - Admin</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Login Check Overlay */
        .login-check {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .login-check.hidden {
            display: none;
        }
        
        .login-check-content {
            text-align: center;
            padding: 40px;
        }
        
        .login-check i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .login-check h2 {
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .login-check p {
            color: var(--gray);
            margin-bottom: 30px;
        }
        
        .login-check-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
    </style>
</head>
<body class="admin-page">
    <!-- Login Check Overlay -->
    <div id="login-check" class="login-check">
        <div class="login-check-content">
            <i class="fas fa-user-shield"></i>
            <h2>Admin Access Required</h2>
            <p>Please login to access the admin dashboard</p>
            <div class="login-check-buttons">
                <a href="login.html" class="btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Go to Login
                </a>
                <a href="index.html" class="btn-secondary">
                    <i class="fas fa-home"></i> Back to Library
                </a>
            </div>
        </div>
    </div>

    <div class="admin-container" id="admin-content" style="display: none;">
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <i class="fas fa-book-reader"></i>
                <div>
                    <h1>Library Admin Panel</h1>
                    <p class="admin-subtitle">Manage Books, Users & Borrowings</p>
                </div>
            </div>
            <div class="admin-controls">
                <div class="admin-info">
                    <span class="admin-name">
                        <i class="fas fa-user"></i>
                        <span id="admin-display-name">Admin</span>
                    </span>
                    <span class="admin-time">
                        <i class="fas fa-clock"></i>
                        <span id="login-time">Just now</span>
                    </span>
                </div>
                <a href="index.html" class="btn-view-user">
                    <i class="fas fa-external-link-alt"></i> View User Site
                </a>
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <div class="admin-layout">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <div class="sidebar-profile">
                    <div class="profile-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="profile-info">
                        <h3 id="sidebar-admin-name">Library Admin</h3>
                        <p>Administrator</p>
                    </div>
                </div>
                
                <nav class="sidebar-nav">
                    <ul>
                        <li class="active" data-section="dashboard">
                            <a href="#">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li data-section="books">
                            <a href="#">
                                <i class="fas fa-book"></i>
                                <span>Manage Books</span>
                                <span class="nav-badge" id="books-count">0</span>
                            </a>
                        </li>
                        <li data-section="add-book">
                            <a href="#">
                                <i class="fas fa-plus-circle"></i>
                                <span>Add New Book</span>
                            </a>
                        </li>
                        <li data-section="borrowings">
                            <a href="#">
                                <i class="fas fa-exchange-alt"></i>
                                <span>Borrowings</span>
                                <span class="nav-badge" id="borrowings-count">0</span>
                            </a>
                        </li>
                        <li data-section="reports">
                            <a href="#">
                                <i class="fas fa-chart-bar"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <div class="sidebar-footer">
                    <p><i class="fas fa-info-circle"></i> Admin Controls</p>
                    <p class="small">Full access to all library functions</p>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="admin-main">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="admin-section active">
                    <div class="section-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                        <div class="last-updated">
                            Last updated: <span id="last-updated">Just now</span>
                        </div>
                    </div>
                    
                    <div class="dashboard-stats">
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="admin-total-books">0</h3>
                                <p>Total Books</p>
                            </div>
                        </div>
                        
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-book-reader"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="admin-borrowed-books">0</h3>
                                <p>Borrowed Books</p>
                            </div>
                        </div>
                        
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="admin-active-users">0</h3>
                                <p>Active Users</p>
                            </div>
                        </div>
                        
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="admin-overdue-books">0</h3>
                                <p>Overdue Books</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-activity">
                        <h3><i class="fas fa-history"></i> Recent Activity</h3>
                        <div id="activity-list" class="activity-list">
                            <!-- Activity items will be added here -->
                        </div>
                    </div>
                </section>

                <!-- Manage Books Section -->
                <section id="books-section" class="admin-section">
                    <div class="section-header">
                        <h2><i class="fas fa-book"></i> Manage Books</h2>
                        <button class="btn-primary" id="refresh-books">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="books-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Genre</th>
                                    <th>Status</th>
                                    <th>Copies</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="books-table-body">
                                <!-- Books will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Add Book Section -->
                <section id="add-book-section" class="admin-section">
                    <div class="section-header">
                        <h2><i class="fas fa-plus-circle"></i> Add New Book</h2>
                        <p class="section-subtitle">Add new books to the library collection</p>
                    </div>
                    
                    <form id="add-book-form" class="admin-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-book-title">
                                    <i class="fas fa-heading"></i> Book Title *
                                </label>
                                <input type="text" id="new-book-title" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="new-book-author">
                                    <i class="fas fa-user-edit"></i> Author *
                                </label>
                                <input type="text" id="new-book-author" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new-book-genre">
                                    <i class="fas fa-tags"></i> Genre *
                                </label>
                                <select id="new-book-genre" required>
                                    <option value="">Select Genre</option>
                                    <option value="Fantasy">Fantasy</option>
                                    <option value="Science">Science</option>
                                    <option value="Mystery">Mystery</option>
                                    <option value="Biography">Biography</option>
                                    <option value="Fiction">Fiction</option>
                                    <option value="Technology">Technology</option>
                                    <option value="History">History</option>
                                    <option value="Romance">Romance</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="new-book-copies">
                                    <i class="fas fa-copy"></i> Copies *
                                </label>
                                <input type="number" id="new-book-copies" min="1" value="1" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="new-book-synopsis">
                                <i class="fas fa-align-left"></i> Synopsis *
                            </label>
                            <textarea id="new-book-synopsis" rows="4" required></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Add Book
                            </button>
                            <button type="button" class="btn-secondary" id="clear-form">
                                <i class="fas fa-times"></i> Clear Form
                            </button>
                        </div>
                    </form>
                </section>

                <!-- Borrowings Section -->
                <section id="borrowings-section" class="admin-section">
                    <div class="section-header">
                        <h2><i class="fas fa-exchange-alt"></i> Manage Borrowings</h2>
                        <div class="filter-controls">
                            <select id="borrowing-filter">
                                <option value="all">All Borrowings</option>
                                <option value="active">Active</option>
                                <option value="overdue">Overdue</option>
                                <option value="returned">Returned</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="borrowings-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Book</th>
                                    <th>Borrower</th>
                                    <th>Borrow Date</th>
                                    <th>Return Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="borrowings-table-body">
                                <!-- Borrowings will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reports-section" class="admin-section">
                    <div class="section-header">
                        <h2><i class="fas fa-chart-bar"></i> Library Reports</h2>
                        <button class="btn-secondary" id="view-stats">
                            <i class="fas fa-chart-pie"></i> View Statistics
                        </button>
                    </div>
                    
                    <div class="reports-grid">
                        <div class="report-card">
                            <h3><i class="fas fa-chart-pie"></i> Genre Distribution</h3>
                            <div class="report-content">
                                <div id="genre-chart-placeholder">
                                    <p>Books distribution by genre</p>
                                    <div class="genre-stats" id="genre-stats"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="report-card">
                            <h3><i class="fas fa-calendar-alt"></i> Monthly Activity</h3>
                            <div class="report-content">
                                <div class="activity-stats">
                                    <div class="activity-stat">
                                        <p>Books Added</p>
                                        <h4 id="monthly-added">0</h4>
                                    </div>
                                    <div class="activity-stat">
                                        <p>Books Borrowed</p>
                                        <h4 id="monthly-borrowed">0</h4>
                                    </div>
                                    <div class="activity-stat">
                                        <p>New Users</p>
                                        <h4 id="monthly-users">0</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="report-card full-width">
                            <h3><i class="fas fa-book"></i> Top Books</h3>
                            <div class="report-content">
                                <div id="top-books-list" class="top-books-list">
                                    <p>Most borrowed books will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content confirm-modal">
            <div class="confirm-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>Confirm Deletion</h2>
            <p id="confirm-message">Are you sure you want to delete this book?</p>
            <div class="confirm-actions">
                <button class="btn-danger" id="confirm-delete">Delete</button>
                <button class="btn-secondary" id="cancel-delete">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Return Book Modal -->
    <div id="return-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Return Book</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="return-book-info"></p>
                <div class="modal-actions">
                    <button class="btn-primary" id="confirm-return">Confirm Return</button>
                    <button class="btn-secondary close-modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="admin-script.js"></script>
    <script>
        // Login check and initialization
        document.addEventListener('DOMContentLoaded', function() {
            const loginCheck = document.getElementById('login-check');
            const adminContent = document.getElementById('admin-content');
            
            // Check if user is logged in
            const isAdmin = localStorage.getItem('isAdmin') === 'true';
            const adminUsername = localStorage.getItem('adminUsername') || 'Admin';
            const loginTime = localStorage.getItem('loginTime');
            
            if (!isAdmin) {
                // Show login overlay
                loginCheck.classList.remove('hidden');
                adminContent.style.display = 'none';
                
                // Auto-redirect to login after 2 seconds
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            } else {
                // Hide login overlay, show admin content
                loginCheck.classList.add('hidden');
                adminContent.style.display = 'block';
                
                // Update admin info
                document.getElementById('admin-display-name').textContent = adminUsername;
                document.getElementById('sidebar-admin-name').textContent = adminUsername;
                
                if (loginTime) {
                    const time = new Date(loginTime);
                    const timeString = time.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    document.getElementById('login-time').textContent = timeString;
                }
                
                // Initialize admin system
                window.adminSystem = new AdminSystem();
            }
            
            // Logout functionality
            document.getElementById('logout-btn').addEventListener('click', function() {
                localStorage.removeItem('isAdmin');
                localStorage.removeItem('adminUsername');
                localStorage.removeItem('loginTime');
                window.location.href = 'login.html';
            });
            
            // View stats button
            document.getElementById('view-stats').addEventListener('click', function() {
                window.adminSystem.showSection('reports');
                window.adminSystem.updateStats();
                window.adminSystem.updateGenreStats();
                window.adminSystem.updateTopBooks();
            });
        });
    </script>
</body>
</html>